import process from 'process'
import { readFileSync, writeFileSync } from 'fs';

// Get browser name
const browserName = process.argv[2];
console.log(`## Merging manifest for: ${browserName}`);

// Read the package.json file
const packageJson = JSON.parse(readFileSync('./package.json', 'utf8'));

// Read manifest base
const manifestBase = JSON.parse(readFileSync('./manifest/base.json', 'utf8'));

// Read manifest of target browser
const manifestBrowser = JSON.parse(readFileSync(`./manifest/${browserName}.json`, 'utf8'));

// Merge everything
const mergedJson = {
  version: packageJson.version,
  ...manifestBase,
  ...manifestBrowser
}

// Prepare manifest content
let fileContent = '// DO NOT edit this file (/src/manifest.json) directly\n';
fileContent += '// Please try to change the settings under the /manifest/*.json\n';
fileContent += JSON.stringify(mergedJson, null, 2);

// Save to file
writeFileSync('./src/manifest.json', fileContent);
console.info(`## Manifest merged successfully!`);
